<!DOCTYPE html>
<html lang="en-uk">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.1.1">
  <meta name="generator" content="Hugo 0.51" />
  <meta name="author" content="Martin Jung">

  
  
  
  
    
  
  <meta name="description" content="In a previous post, I gave a brief introduction how to use google cloud compute to kickstart your cloud computing experience. While it is possible to run large spatial operations on google cloud compute, it is quite time-consuming to set up all the routines to load and process geospatial data. Luckily there is now a new platform (currently in beta-testing) called Google Earth Engine (GEE) described as planetary scale platform for spatial analyses.">

  
  <link rel="alternate" hreflang="en-uk" href="http://martin-jung.github.io/post/2018_googleearthengine-intro/">

  


  

  

  

  
  
  
  <meta name="theme-color" content="#4caf50">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai.min.css" crossorigin="anonymous">
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="anonymous">
    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  
  <link rel="stylesheet" href="/css/custom.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-118877355-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="http://martin-jung.github.io/index.xml" type="application/rss+xml" title="Martin Jung - Environmental and data scientist">
  <link rel="feed" href="http://martin-jung.github.io/index.xml" type="application/rss+xml" title="Martin Jung - Environmental and data scientist">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="http://martin-jung.github.io/post/2018_googleearthengine-intro/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@Martin_Ecology">
  <meta property="twitter:creator" content="@Martin_Ecology">
  
  <meta property="og:site_name" content="Martin Jung - Environmental and data scientist">
  <meta property="og:url" content="http://martin-jung.github.io/post/2018_googleearthengine-intro/">
  <meta property="og:title" content="Introduction to Google Earth Engine | Martin Jung - Environmental and data scientist">
  <meta property="og:description" content="In a previous post, I gave a brief introduction how to use google cloud compute to kickstart your cloud computing experience. While it is possible to run large spatial operations on google cloud compute, it is quite time-consuming to set up all the routines to load and process geospatial data. Luckily there is now a new platform (currently in beta-testing) called Google Earth Engine (GEE) described as planetary scale platform for spatial analyses.">
  
  
    
  <meta property="og:image" content="http://martin-jung.github.io/img/laptop.png">
  <meta property="og:locale" content="en-uk">
  
  <meta property="article:published_time" content="2018-07-22T00:00:00&#43;01:00">
  
  <meta property="article:modified_time" content="2018-07-22T00:00:00&#43;01:00">
  

  

  <!DOCTYPE html>


<title>Introduction to Google Earth Engine - Martin Jung - Environmental and data scientist</title>
<meta property="og:title" content="Introduction to Google Earth Engine - Martin Jung - Environmental and data scientist">
<meta property="og:type" content="article">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/seabbs/seabbs.github.io/sources/static/img/laptop.png" >
  


<meta property="description" content="Article posted by %!s(&lt;nil&gt;), on Sunday, July 22nd, 2018">
<meta property="og:description" content="Article posted by %!s(&lt;nil&gt;), on Sunday, July 22nd, 2018">


<meta name="twitter:creator" content="">
<meta name="twitter:site" content="">


  <title>Introduction to Google Earth Engine | Martin Jung - Environmental and data scientist</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/"><img src="/img/laptop.png" alt="Martin Jung - Environmental and data scientist"></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>About</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Blog</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/pdf/mjung_cv_latest.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

      

        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  













<div class="article-header d-xl-none">
  <img src="/post/2018_googleearthengine-intro/featured_huc584e4beb21379335aed2fb4a1633d4f_785827_1600x400_fill_q90_box_left_2.png" class="article-banner" itemprop="image" alt="">
  <span class="article-header-caption">Processing and analysing remote-sensing data in the cloud</span>
</div>


<div class="container-fluid split-header d-none d-xl-block">
  <div class="row">
    <div class="col-6">
      <div class="split-header-content">
        <h1 itemprop="name">Introduction to Google Earth Engine</h1>

        

        

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Martin Jung">
  </span>
  

  <span class="article-date">
    
    <meta content="2018-07-22 00:00:00 &#43;0100 BST" itemprop="datePublished">
    <time datetime="2018-07-22 00:00:00 &#43;0100 BST" itemprop="dateModified">
      2018 Jul 22
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Martin Jung">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="/post/2018_googleearthengine-intro/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/categories/cloud-computing/">cloud-computing</a>
    
  </span>
  
  

  

</div>


        







  










        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Introduction%20to%20Google%20Earth%20Engine&amp;url=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f&amp;title=Introduction%20to%20Google%20Earth%20Engine"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f&amp;title=Introduction%20to%20Google%20Earth%20Engine"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Introduction%20to%20Google%20Earth%20Engine&amp;body=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
    </div>
    <div class="col-6">
      <div class="split-header-image">
        <img src="/post/2018_googleearthengine-intro/featured_huc584e4beb21379335aed2fb4a1633d4f_785827_680x500_fill_q90_box_left_2.png" itemprop="image" alt="">
        <span class="article-header-caption">Processing and analysing remote-sensing data in the cloud</span>
      </div>
    </div>
  </div>
</div>

<div class="article-container d-xl-none">
  <h1 itemprop="name">Introduction to Google Earth Engine</h1>

  

  

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Martin Jung">
  </span>
  

  <span class="article-date">
    
    <meta content="2018-07-22 00:00:00 &#43;0100 BST" itemprop="datePublished">
    <time datetime="2018-07-22 00:00:00 &#43;0100 BST" itemprop="dateModified">
      2018 Jul 22
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Martin Jung">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="/post/2018_googleearthengine-intro/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/categories/cloud-computing/">cloud-computing</a>
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Introduction%20to%20Google%20Earth%20Engine&amp;url=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f&amp;title=Introduction%20to%20Google%20Earth%20Engine"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f&amp;title=Introduction%20to%20Google%20Earth%20Engine"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Introduction%20to%20Google%20Earth%20Engine&amp;body=http%3a%2f%2fmartin-jung.github.io%2fpost%2f2018_googleearthengine-intro%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


  







  









</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <p>In a previous post, I gave a brief introduction how to use <a href="http://martin-jung.github.io/post/2018_datascienceingooglecloud/" target="_blank">google cloud compute</a> to kickstart your cloud computing experience. While it is possible to run large spatial operations on google cloud compute, it is quite time-consuming to set up all the routines to load and process geospatial data. Luckily there is now a new platform (currently in beta-testing) called Google Earth Engine (GEE) described as <a href="https://earthengine.google.com/" target="_blank">planetary scale platform for spatial analyses</a>.
<br />
<br>
GEE is (currently) free to use and users can sign up for a <a href="https://earthengine.google.com/signup/" target="_blank">beta-testing</a>. There are a <a href="https://earthengine.google.com/datasets/" target="_blank">wide range of datasets</a> already available within GEE, including all available Landsat, Sentinel and MODIS satellite data. GEE furthermore allows to pre-process these layers and the fantastatic google team also already pre-computed layers such as cloud masks or ingested fully radiometrically corrected layers. If the reader is interested in what is possible with GEE, have a look at the <a href="https://earthengine.google.com/case_studies/" target="_blank">case studies</a> on the GEE website.
<br />
<hr>
In the rest of this post I will showcase some exemplary scripts I coded in <strong>Javascript</strong> which, besides <strong>python</strong>, is the primary way to access and pre-process data in GEE. I will mostly only comment on my script as there are extensive tutorials, videos and detailed API descriptions <a href="https://developers.google.com/earth-engine/" target="_blank">available</a> for GEE.
<br />
Whenever I load outside data (such as ESRI shapefiles) into GEE, I usually convert them to a KML file and then load them as Google Fusion Table (search online how to do this). All the (java-)scripts below can be pasted into the <a href="https://code.earthengine.google.com" target="_blank">GEE code console</a>, but if any errors occur then usually because of missing permissions (you might not be able to access my Google Fusion Tables).
</p>

<p>The following script quantifies the date of forest loss from the <a href="https://earthenginepartners.appspot.com/science-2013-global-forest/download_v1.5.html" target="_blank">Hansen forest cover dataset</a></p>

<pre><code class="language-javascript">// Load the global Hansen forest dataset
var gfcImage = ee.Image(&quot;UMD/hansen/global_forest_change_2017_v1_5&quot;);
/*
@author Martin Jung - m.jung@sussex.ac.uk
Idea:
Get average date of forest loss within sampling extent
*/

// Coordinates and parameters
// (This is a fusiontable id containing my polygon shapefile)
var fullsites = ee.FeatureCollection('ft:1Oet2yGWvldNoVx8A6ZlCi75Ks_lrEG0dG9oD6k2j'); // All sites

//////// Other Parameters //////////
var export_geometry = false; // export the geometry in the csv
var scale = 30; // Resolution over which image collection should be reduced, 30 m = native scale
var reduce = ee.Reducer.mean() // Reducer for image collection
// Also available max(), mean(), median(), min(), mode(), or(), product(), sum(), stdDev()
var what = &quot;ForestLoss&quot;; // Export name

// ################################################################### //
//                Function and main CODE starts here                   //
// ################################################################### //

// Create TimeBand
function createTimeBand(image) {
  return image.addBands(image.metadata('system:time_start'));
}

// ---- //
// Select the band with loss year
var forestImage = gfcImage.select(['lossyear']);
// Mask out pixels with no lossyear
var m = forestImage.gt(0);
forestImage = forestImage.mask(m);

// -------------------------------- //
// Reduce per polygon per polygon
var extracted = forestImage.reduceRegions(fullsites, reduce, scale);

Export.table.toDrive({
  collection: extracted.select([&quot;.*&quot;], null, export_geometry),
  description: &quot;PREDICTSHansen_&quot;+what,
  fileNamePrefix: &quot;PREDICTSHansen_&quot;+what,
  fileFormat: 'geoJSON'
});
</code></pre>

<p><br>
Not too difficult, right?
<br />
Here is another script that calculates a 95 % percentile composite of three months of EVI data calculated from all available Landsat surface reflectance images from 1984 to 2017. My script furthermore exclude all pixels that are clearly covered by water (using data from <a href="https://www.nature.com/articles/nature20584" target="_blank">Pekel et al. 2016</a> ) and mask out unsuitable images (too many clouds) as well as clouds and cloud-shadows. Finally the mean, composited EVI within a buffer was exported.
Full script below:
<br></p>

<pre><code class="language-javascript">// Images and shapefiles
// Including landsat Level 1 land-surface-reflectance bands
var l8_led = ee.ImageCollection(&quot;LANDSAT/LC08/C01/T1_SR&quot;),
    l4_led = ee.ImageCollection(&quot;LANDSAT/LT04/C01/T1_SR&quot;),
    l5_led = ee.ImageCollection(&quot;LANDSAT/LT05/C01/T1_SR&quot;),
    l7_led = ee.ImageCollection(&quot;LANDSAT/LE07/C01/T1_SR&quot;),
    gsw = ee.Image(&quot;JRC/GSW1_0/GlobalSurfaceWater&quot;), // Global Surface water dataset
    usgadm = ee.FeatureCollection(&quot;ft:1kA8n0e3lvUVuWJSixVf5WaPyeqskp8kZg9zU9TBX&quot;),
    bbs_union = ee.FeatureCollection(&quot;ft:1hqCRJam4b3niJZgRmJkOOMEe_qTwM77gZ-TyP4pe&quot;), // Shapefiles I use my analyses. They contain polygons
    bbs = ee.FeatureCollection(&quot;ft:1gUxInqbJAG-kcH6bn6PioNnZ6G7fZOBIIaEADnIO&quot;);
/*
author: Martin Jung - 2018 (m.jung@sussex.ac.uk)
Idea:
Calculate avg overall EVI for all routes.
*/
// Parameters
var scale = 30; // Resolution over which image collection should be reduced, 30m = native scale
var precision = 10000; // Rounding precision
var cloudlimit = 80; // Should images with that many clouds be kept ? In order to reduce effect on non-filtered shades
var reduce = ee.Reducer.percentile([95]) ; // How should composites be reduced?
var startmonth = 3; // start Month when to use images from
var endmonth = 6; // end month
var startday = 20; // start day
var endday = 20; // end day
var fname = &quot;EVIstack&quot;; // FileNamedDescription
var what = 'evi'; // Name of resulting spectral index band

// Expressions
var f_evi = '2.5 * ((nir - red) / (nir + 2.4 * red + 1))'; // EVI2 formula (two-band version)

// ################################################################### //
//                Function and main CODE starts here                   //
// ################################################################### //

// Function to mask excess EVI values defined as &gt; 1 and &lt; 0
var maskExcess = function(image) {
    var hi = image.lte(1);
    var lo = image.gte(0);
    var masked = image.mask(hi.and(lo));
    return image.mask(masked);
  };

// Function to remove clouds - expects the new SR data to have a cfmask layer
// 126122017 - Adapted to work with LT1
var maskclouds = function(scene) {
  // The &quot;pixel_qa&quot; band has various flags encoded in
  // different bits.  We extract some of them as individual mask bands.
  // Note: Cloud masking information is present in &quot;pixel_qa&quot;
  // pixel_qa Bit 1: Clear pixel indicator.
  // pixel_qa Bit 2: Water indicator.
  // pixel_qa Bit 3: Cloud shadow indicator.
  // pixel_qa Bit 5: Cloud indicator.
  // pixel_qa Bits 6-7: Cloud confidence.
  // Fill = https://explorer.earthengine.google.com/#detail/LANDSAT%2FLE07%2FC01%2FT1_SR
  var clear = scene.select('pixel_qa').bitwiseAnd(2).neq(0);
  clear = scene.updateMask(clear);
  return(clear);
};

// Water mask all pixels with over 90 % water occurence
var water_mask = gsw.select('occurrence').gt(90).unmask(0);
var watermask = function(image){
  var masked = water_mask.eq(0);
  return image.mask(masked);
};

// Create TimeBand
function createTimeBand(image) {
  return image.addBands(image.metadata('system:time_start'));
}

// Filter out those bands with no images and create and empty image where there is none
// (This function should not be necessary as the area I investigate has full availability of Landsat 4-8)
var conditional = function(image) {
  return ee.Algorithms.If(ee.Number(image.get('num_elements')).gt(0),
                          image,
                          ee.Image(0).toDouble()
                          .set('system:time_start',image.get('system:time_start'))
                          .rename(what));
};

// VegIndex calculator. Calculate the EVI index (two-band versiob)
function calcIndex(image){
  var evi = image.expression(
      f_evi,
        {
          red: image.select('red').multiply(0.0001),    // 620-670nm, RED
          nir: image.select('nir').multiply(0.0001)    // 841-876nm, NIR
        });
    // Rename that band to something appropriate
    var dimage = ee.Date(ee.Number(image.get('system:time_start'))).format();
    return evi.select([0], [what]).set({'datef': dimage,'system:time_start': ee.Number(image.get('system:time_start'))});
}

// ----------------------------------------- //
// Further PROCESSING CODE STARTS BELOW              //
// ----------------------------------------- //

// Load the polygon shapefiles for my analysis and use a bounding box to clip all outputs
var bbs_filter = bbs_union;
var bbox = bbs_filter.geometry().bounds();
Map.addLayer(bbs_filter);Map.addLayer(bbox) // Add to map and center to it


  // Filter the layers and set bounds
  // get the LC8 collection
  var L8 = l8_led
     .filterBounds(bbox) // filter all Landsat images by bound
     .filterDate(ee.Date.fromYMD(1984,startmonth,startday), ee.Date.fromYMD(2017,endmonth,endday)) // Filter to up to latest sampling
     .filterMetadata('CLOUD_COVER_LAND','less_than',cloudlimit) // Ignore images with too many clouds
     .map(maskclouds) // mask clouds and cloud-shadows from the image
     .map(watermask) // mask out water
     .map(createTimeBand); // add a time band

  // get the LE7 collection
  var L7 = l7_led
     .filterBounds(bbox)
     .filterDate(ee.Date.fromYMD(1984,startmonth,startday), ee.Date.fromYMD(2017,endmonth,endday)) // Filter to up to latest sampling
     .filterMetadata('CLOUD_COVER_LAND','less_than',cloudlimit)
     .map(maskclouds)
     .map(watermask)
     .map(createTimeBand);

  // get the LE5 collection
  var L5 = l5_led
     .filterBounds(bbox)
     .filterDate(ee.Date.fromYMD(1984,startmonth,startday), ee.Date.fromYMD(2017,endmonth,endday)) // Filter to up to latest sampling
     .filterMetadata('CLOUD_COVER_LAND','less_than',cloudlimit)
     .map(maskclouds)
     .map(watermask)
     .map(createTimeBand);

  // get the LE5 collection
  var L4 = l4_led
     .filterBounds(bbox)
     .filterDate(ee.Date.fromYMD(1984,startmonth,startday), ee.Date.fromYMD(2017,endmonth,endday)) // Filter to up to latest sampling
     .filterMetadata('CLOUD_COVER_LAND','less_than',cloudlimit)
     .map(maskclouds)
     .map(watermask)
     .map(createTimeBand);

  // Rename bands for all (note that band number change between Landsat satellites)
  var L4 = L4.map(function(image){
    return image.select(
      ['B1','B2','B3','B4','B5','B7'],
      ['blue','green','red','nir','swir1','swir2']
      );
  });
  var L5 = L5.map(function(image){
    return image.select(
      ['B1','B2','B3','B4','B5','B7'],
      ['blue','green','red','nir','swir1','swir2']
      );
  });
  var L7 = L7.map(function(image){
    return image.select(
      ['B1','B2','B3','B4','B5','B7'],
      ['blue','green','red','nir','swir1','swir2']
      );
  });
  var L8 = L8.map(function(image){
    return image.select(
      ['B2','B3','B4','B5','B6','B7'],
      ['blue','green','red','nir','swir1','swir2']
      );
  });

  // Merge the collections
  // this collection is sorted by time
  var Collection = ee.ImageCollection(L8.merge(L7))
                        .sort('system:time_start',true);
  Collection = ee.ImageCollection(Collection.merge(L5))
                        .sort('system:time_start',true);
  Collection = ee.ImageCollection(Collection.merge(L4))
                        .sort('system:time_start',true);

  // Calculate an vegetation index on full collection
  Collection = Collection.map( calcIndex );
  // --------------------------------------------------- //
  // Mask out pixels with excess values (sensor errors)
  Collection = Collection.map( maskExcess );

  // Clip to feature collection geometry
  Collection = Collection.map(function(i){return i.clip(bbs_filter);});    

  // Reduce the time series of images into a single image
  var img = Collection.reduce(reduce);
  // --------------------------------- //

  // Run function to calculate the mean per polygon
  var extract = function(img,bbs){
    var extracted = img.reduceRegions(bbs, ee.Reducer.mean(), scale);
    return extracted;
  };

  // The extracted results
  var results = extract(img, bbs);

  // Export the output
  Export.table.toDrive({
      collection: results,
      folder: 'CropscapeTest', // Folder name in google drive
      description: 'Annual_' + fname + &quot;_AvgEVI&quot; + '_'+fname,
      fileNamePrefix : 'Annual_' + fname + &quot;_AvgEVI&quot; + '_'+fname,
      fileFormat: 'geoJSON'
  });

</code></pre>

<p>Hope these examples were helpful. I might post more of my code-examples at a later point.</p>

<p>Cheers, <br />
Martin</p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/gis/">gis</a>
  
  <a class="badge badge-light" href="/tags/cloud-computing/">cloud-computing</a>
  
  <a class="badge badge-light" href="/tags/google-earth-engine/">google-earth-engine</a>
  
  <a class="badge badge-light" href="/tags/google-cloud/">google-cloud</a>
  
  <a class="badge badge-light" href="/tags/remote-sensing/">remote-sensing</a>
  
</div>



    






<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  <img class="portrait mr-3" src="https://s.gravatar.com/avatar/47bd5ae369dbfa9a2c7889853c3f959d?s=200')" itemprop="image" alt="Avatar">
  
  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/">Martin Jung</a></h5>
    <h6 class="card-subtitle">Environmental &amp; data scientist</h6>
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
      
      
      
      
      <li>
        <a itemprop="sameAs" href="mailto:martinjung-at-zoho.com" >
          <i class="fa fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//linkedin.com/in/jungmartin" >
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://twitter.com/Martin_Ecology" target="_blank" rel="noopener">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://github.com/Martin-Jung" target="_blank" rel="noopener">
          <i class="fab fa-github"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://scholar.google.co.uk/citations?user=qa-Dz6QAAAAJ&amp;hl" target="_blank" rel="noopener">
          <i class="ai ai-google-scholar"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://publons.com/author/589847/martin-jung" target="_blank" rel="noopener">
          <i class="ai ai-publons"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://gis.stackexchange.com/users/6988/curlew" target="_blank" rel="noopener">
          <i class="fab fa-stack-overflow"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/2018-phd-poster-prize/">PhD research image prize</a></li>
        
        <li><a href="/post/2018_datascienceingooglecloud/">Data science in the Google cloud - [1]</a></li>
        
        <li><a href="/project/greece/">The impact of economic recession on land changes in Greece</a></li>
        
        <li><a href="/project/bialowieza/">Remotely sensed forest monitoring in Bialowieza forest</a></li>
        
        <li><a href="/publication/2016_lecos/">LecoS - A python plugin for automated landscape ecology analysis</a></li>
        
      </ul>
    </div>
    

    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "martinjung" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      Martin Jung 2017-2018 &bull; <a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa fa-cc" aria-hidden="true"></i></a> &middot; 
      

      <p style="font-size:12px;">
       &bull; <a href="http://martin-jung.github.io/data/mj-pubkey.asc">PGP public <i class="fa fa-key"></i></a> &bull; <br />
       BD4B 2D2C B8E3 A95B 076A
       6FA0 99DC 99BA 1BC8 BC37
      </p>

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>
        
    
    
    
    
      
      
      
        
      
    
    
  
    </p>
  </div>
</footer>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin="anonymous"></script>
    

    
    
    
    <script id="dsq-count-scr" src="//martinjung.disqus.com/count.js" async></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "Search Results",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.2861db6bcf2db4b5eade32c795453e47.js"></script>

    

  </body>
</html>

